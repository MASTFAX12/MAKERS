<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | MAK Team HQ</title>
    <meta name="description" content="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ÙØ±ÙŠÙ‚ Ù…ÙŠÙƒØ±Ø²">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Fira+Code:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/effects.css">
    <link rel="stylesheet" href="css/icons.css">
    <link rel="stylesheet" href="css/ai-components.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

    <!-- Favicon -->
    <link rel="icon" href="assets/images/logo.jpg" type="image/jpeg">
</head>

<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <img src="assets/images/logo.jpg" alt="MAK" class="loading-logo">
        <div class="loading-text">MAK Team HQ</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="assets/images/logo.jpg" alt="MAK Logo">
                <span class="logo-text">MAK</span>
            </a>

            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="team.html">Ø§Ù„ÙØ±ÙŠÙ‚</a></li>
                <li><a href="projects.html">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</a></li>
                <li>
                    <div class="notification-bell" onclick="toggleNotifications()">
                        ğŸ””
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="notification-header">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                            <div class="notification-list" id="notificationList"></div>
                        </div>
                    </div>
                </li>
                <li><a href="#" onclick="Auth.logout()" class="btn btn-secondary">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a></li>
            </ul>

            <div class="menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Mobile Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        â˜°
    </button>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="assets/images/logo.jpg" alt="MAK" class="sidebar-logo">
                <div class="sidebar-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            </div>

            <!-- Level Badge in Sidebar -->
            <div id="sidebarLevel" style="padding: 0 1rem 1rem;"></div>

            <ul class="sidebar-menu">
                <li>
                    <a href="#" class="active" data-section="overview" onclick="showSection('overview')">
                        <span class="menu-icon"><i data-lucide="layout-dashboard"></i></span>
                        Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
                    </a>
                </li>
                <li>
                    <a href="#" data-section="projects" onclick="showSection('projects')">
                        <span class="menu-icon"><i data-lucide="folder-kanban"></i></span>
                        Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                    </a>
                </li>
                <li>
                    <a href="#" data-section="add-project" onclick="showSection('add-project')">
                        <span class="menu-icon"><i data-lucide="folder-plus"></i></span>
                        Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                    </a>
                </li>
                <li>
                    <a href="#" data-section="calendar" onclick="showSection('calendar')">
                        <span class="menu-icon"><i data-lucide="calendar-days"></i></span>
                        Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
                    </a>
                </li>
                <li>
                    <a href="#" data-section="members" onclick="showSection('members')">
                        <span class="menu-icon"><i data-lucide="users"></i></span>
                        Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                    </a>
                </li>
                <li>
                    <a href="#" data-section="achievements" onclick="showSection('achievements')">
                        <span class="menu-icon"><i data-lucide="trophy"></i></span>
                        Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
                    </a>
                </li>
                <li>
                    <a href="#" data-section="activity" onclick="showSection('activity')">
                        <span class="menu-icon"><i data-lucide="activity"></i></span>
                        Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </a>
                </li>
                <li>
                    <a href="#" data-section="settings" onclick="showSection('settings')">
                        <span class="menu-icon"><i data-lucide="settings"></i></span>
                        Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </a>
                </li>
            </ul>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer"
                style="padding: 1rem; border-top: 1px solid var(--border-color); margin-top: auto;">
                <small style="color: var(--text-muted);">MAK Team HQ v2.0</small>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Overview Section -->
            <section id="section-overview" class="dashboard-section">
                <div class="dashboard-header">
                    <div class="dashboard-welcome">
                        <h1 id="greetingText">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù…ØµØ·ÙÙ‰</h1>
                        <p class="dashboard-date" id="currentDate"></p>
                    </div>
                    <button class="btn btn-primary btn-shine" onclick="showSection('add-project')">
                        â• Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>

                <!-- Stats Cards -->
                <div id="statsContainer"></div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <!-- Contribution Panel -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">ğŸ“ˆ Ù…Ø³Ø§Ù‡Ù…Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
                        </div>
                        <div class="panel-body">
                            <ul class="contribution-list" id="dashContribution"></ul>
                        </div>
                    </div>

                    <!-- Deadlines Panel -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                        </div>
                        <div class="panel-body">
                            <ul class="deadline-list" id="dashDeadlines"></ul>
                        </div>
                    </div>
                </div>

                <!-- Subject Stats -->
                <div class="panel mt-4">
                    <div class="panel-header">
                        <h3 class="panel-title">ğŸ“š Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©</h3>
                    </div>
                    <div class="panel-body">
                        <ul class="subject-stats" id="dashSubjects"></ul>
                    </div>
                </div>

                <!-- Quick Actions Cards -->
                <div class="quick-cards"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div class="card card-3d" onclick="showSection('add-project')"
                        style="cursor: pointer; text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">â•</div>
                        <div style="font-weight: 600;">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</div>
                    </div>
                    <div class="card card-3d" onclick="showSection('calendar')"
                        style="cursor: pointer; text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ“…</div>
                        <div style="font-weight: 600;">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
                    </div>
                    <div class="card card-3d" onclick="showSection('achievements')"
                        style="cursor: pointer; text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ†</div>
                        <div style="font-weight: 600;">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
                    </div>
                    <div class="card card-3d" onclick="App.exportData()"
                        style="cursor: pointer; text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ“¤</div>
                        <div style="font-weight: 600;">ØªØµØ¯ÙŠØ±</div>
                    </div>
                </div>
            </section>

            <!-- Projects Section -->
            <section id="section-projects" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h1>
                    <button class="btn btn-primary btn-shine" onclick="showSection('add-project')">
                        â• Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>

                <div class="filter-bar">
                    <div class="filter-group">
                        <span class="filter-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                        <select class="filter-select" id="dashFilterStatus" onchange="loadProjects()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="new">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="in_progress">Ø¬Ø§Ø±ÙŠ</option>
                            <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Ø§Ù„Ù…Ø§Ø¯Ø©:</span>
                        <select class="filter-select" id="dashFilterSubject" onchange="loadProjects()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                        </select>
                    </div>
                </div>

                <div class="projects-grid" id="dashProjects"></div>
            </section>

            <!-- Add Project Section -->
            <section id="section-add-project" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h1>
                </div>

                <div class="card cyber-border" style="max-width: 700px;">
                    <form id="newProjectForm">
                        <!-- Project Title -->
                        <div class="form-group">
                            <label class="form-label">ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                            <input type="text" class="form-input" id="projectTitle" required
                                placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª">
                        </div>

                        <!-- Description -->
                        <div class="form-group">
                            <label class="form-label">ğŸ“‹ Ø§Ù„ÙˆØµÙ</label>
                            <textarea class="form-textarea" id="projectDescription"
                                placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ø´Ø±ÙˆØ¹..."></textarea>
                        </div>

                        <!-- Subject -->
                        <div class="form-group">
                            <label class="form-label">ğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                            <select class="form-select" id="projectSubject" required onchange="updateMemberSelection()">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                            </select>
                        </div>

                        <!-- Team Size -->
                        <div class="form-group">
                            <label class="form-label">ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ *</label>
                            <div class="team-size-selector">
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="1" id="size1"
                                        onchange="updateMemberSelection()">
                                    <label for="size1">1</label>
                                </div>
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="2" id="size2"
                                        onchange="updateMemberSelection()">
                                    <label for="size2">2</label>
                                </div>
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="3" id="size3" checked
                                        onchange="updateMemberSelection()">
                                    <label for="size3">3</label>
                                </div>
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="4" id="size4"
                                        onchange="updateMemberSelection()">
                                    <label for="size4">4</label>
                                </div>
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="5" id="size5"
                                        onchange="updateMemberSelection()">
                                    <label for="size5">5</label>
                                </div>
                                <div class="team-size-option">
                                    <input type="radio" name="teamSize" value="6" id="size6"
                                        onchange="updateMemberSelection()">
                                    <label for="size6">6</label>
                                </div>
                            </div>
                        </div>

                        <!-- Deadline -->
                        <div class="form-group">
                            <label class="form-label">â° Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ *</label>
                            <input type="date" class="form-input" id="projectDeadline" required>
                        </div>

                        <!-- Priority -->
                        <div class="form-group">
                            <label class="form-label">âš¡ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</label>
                            <div class="priority-selector">
                                <div class="priority-option low">
                                    <input type="radio" name="priority" value="low" id="priorityLow">
                                    <label for="priorityLow">Ø¹Ø§Ø¯ÙŠ</label>
                                </div>
                                <div class="priority-option normal">
                                    <input type="radio" name="priority" value="normal" id="priorityNormal" checked>
                                    <label for="priorityNormal">Ù…ØªÙˆØ³Ø·</label>
                                </div>
                                <div class="priority-option high">
                                    <input type="radio" name="priority" value="high" id="priorityHigh">
                                    <label for="priorityHigh">Ù…Ù‡Ù…</label>
                                </div>
                                <div class="priority-option urgent">
                                    <input type="radio" name="priority" value="urgent" id="priorityUrgent">
                                    <label for="priorityUrgent">Ø¹Ø§Ø¬Ù„</label>
                                </div>
                            </div>
                        </div>

                        <!-- Team Selection -->
                        <div class="form-group">
                            <label class="form-label">ğŸ§  Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ (Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªÙ‚ØªØ±Ø­ Ø§Ù„Ø£ÙØ¶Ù„ â­)</label>
                            <div class="member-selection" id="memberSelection">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Submit -->
                        <div class="form-group" style="margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-shine" style="width: 100%;">
                                ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Calendar Section -->
            <section id="section-calendar" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1>ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h1>
                    <button class="btn btn-secondary" onclick="Calendar.goToToday()">Ø§Ù„ÙŠÙˆÙ…</button>
                </div>

                <div id="calendarContainer" style="max-width: 800px;"></div>
            </section>

            <!-- Members Section -->
            <section id="section-members" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h1>
                </div>

                <div class="members-grid" id="dashMembers"></div>
            </section>

            <!-- Achievements Section -->
            <section id="section-achievements" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1>ğŸ† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h1>
                </div>

                <!-- Level Card -->
                <div class="card cyber-border" style="max-width: 400px; margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">ğŸ“Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ±ÙŠÙ‚</h3>
                    <div id="achievementLevel"></div>
                </div>

                <!-- Achievements Grid -->
                <div class="card" style="max-width: 800px;">
                    <h3 style="margin-bottom: 1.5rem;">ğŸ–ï¸ Ø§Ù„Ø£ÙˆØ³Ù…Ø©</h3>
                    <div class="badge-container" id="achievementsBadges" style="justify-content: center;"></div>

                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                        <h4 style="margin-bottom: 1rem;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h4>
                        <div id="achievementsList"></div>
                    </div>
                </div>
            </section>

            <!-- Activity Log Section -->
            <section id="section-activity" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1 class="section-header-icon">
                        <i data-lucide="activity"></i>
                        Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </h1>
                </div>

                <div class="card" style="max-width: 800px;">
                    <div class="activity-log" id="activityLogContainer">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="section-settings" class="dashboard-section hidden">
                <div class="dashboard-header">
                    <h1 class="section-header-icon">
                        <i data-lucide="settings"></i>
                        Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </h1>
                </div>

                <!-- User Profile Card -->
                <div class="card" style="max-width: 600px; margin-bottom: 1.5rem;">
                    <h3 class="mb-3 icon-text"><i data-lucide="user"></i> Ø­Ø³Ø§Ø¨ÙŠ</h3>
                    <div class="user-badge" id="currentUserBadge">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <div class="card" style="max-width: 600px; margin-bottom: 1.5rem;">
                    <h3 class="mb-3 icon-text"><i data-lucide="key"></i> ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø´Ø®ØµÙŠ (PIN)</h3>
                    <form id="pinChangeForm">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                            <input type="password" class="form-input" id="oldPin" required maxlength="4"
                                placeholder="****">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯ (4 Ø£Ø±Ù‚Ø§Ù…)</label>
                            <input type="password" class="form-input" id="newPin" required maxlength="4"
                                placeholder="****">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                            <input type="password" class="form-input" id="confirmPin" required maxlength="4"
                                placeholder="****">
                        </div>
                        <button type="submit" class="btn btn-primary icon-text">
                            <i data-lucide="save"></i>
                            Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯
                        </button>
                    </form>
                </div>

                <div class="card" style="max-width: 600px; margin-bottom: 1.5rem;">
                    <h3 class="mb-3 icon-text"><i data-lucide="volume-2"></i> Ø§Ù„ØµÙˆØª</h3>
                    <label style="display: flex; align-items: center; gap: 1rem; cursor: pointer;">
                        <input type="checkbox" id="soundToggle" checked onchange="Effects.toggleSound()">
                        <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
                    </label>
                </div>

                <div class="card" style="max-width: 600px;">
                    <h3 class="mb-3 icon-text"><i data-lucide="database"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary icon-text" onclick="App.exportData()">
                            <i data-lucide="download"></i>
                            ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <label class="btn btn-secondary icon-text" style="cursor: pointer;">
                            <i data-lucide="upload"></i>
                            Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            <input type="file" accept=".json" onchange="App.importData(this.files[0])"
                                style="display: none;">
                        </label>
                        <button class="btn btn-secondary icon-text"
                            style="border-color: var(--danger); color: var(--danger);" onclick="App.resetData()">
                            <i data-lucide="trash-2"></i>
                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/firebase.js"></script>
    <script src="js/firebase-db.js"></script>
    <script src="js/firebase-storage.js"></script>
    <script src="js/gemini.js"></script>
    <script src="js/ai-features.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/project-features.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/algorithm.js"></script>
    <script src="js/members.js"></script>
    <script src="js/projects.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/app.js"></script>
    <script src="js/effects.js"></script>



    <script>
        // Protect page
        if (!Auth.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        // Initialize platform on load
        (async function initPlatform() {
            try {
                // Initialize Firebase
                await Firebase.init();
                await FirebaseDB.init();

                // Initialize notifications
                await Notifications.init();

                // Initialize AI features
                AIFeatures.init();

                console.log('ğŸš€ MAK Platform v3.0 initialized');
            } catch (error) {
                console.error('Platform init error:', error);
            }
        })();

        // Toggle mobile menu
        function toggleMobileMenu() {
            document.querySelector('.nav-links').classList.toggle('active');
            document.querySelector('.menu-toggle').classList.toggle('active');
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Toggle notifications
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.classList.toggle('active');

            // Render notification panel
            if (dropdown.classList.contains('active')) {
                dropdown.innerHTML = Notifications.renderPanel();
                lucide.createIcons();
            }
        }

        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(s => s.classList.add('hidden'));

            // Show selected section
            const section = document.getElementById('section-' + sectionId);
            if (section) section.classList.remove('hidden');

            // Update sidebar active state
            document.querySelectorAll('.sidebar-menu a').forEach(a => {
                a.classList.remove('active');
                if (a.dataset.section === sectionId) a.classList.add('active');
            });

            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                document.getElementById('sidebar').classList.remove('active');
            }

            // Refresh section data
            if (sectionId === 'overview') loadOverview();
            if (sectionId === 'projects') loadProjects();
            if (sectionId === 'add-project') loadAddProjectForm();
            if (sectionId === 'calendar') Calendar.init('calendarContainer');
            if (sectionId === 'members') loadMembers();
            if (sectionId === 'achievements') loadAchievements();
            if (sectionId === 'activity') loadActivityLog();

            // Re-render icons
            setTimeout(() => lucide.createIcons(), 50);
        }

        // Load activity log
        function loadActivityLog() {
            ActivityLog.render(document.getElementById('activityLogContainer'), { count: 50 });
        }

        // Load overview
        function loadOverview() {
            Charts.renderStatsOverview(document.getElementById('statsContainer'));
            Members.renderContributionChart(document.getElementById('dashContribution'));
            Projects.renderDeadlines(document.getElementById('dashDeadlines'), 14);
            Projects.renderSubjectStats(document.getElementById('dashSubjects'));
        }

        // Load projects
        function loadProjects() {
            const status = document.getElementById('dashFilterStatus').value;
            const subject = document.getElementById('dashFilterSubject').value;

            const filter = {};
            if (status) filter.status = status;
            if (subject) filter.subject = subject;

            Projects.renderAll(document.getElementById('dashProjects'), Object.keys(filter).length ? filter : null, true);
        }

        // Load add project form
        function loadAddProjectForm() {
            const settings = App.getSettings();
            const subjectSelect = document.getElementById('projectSubject');

            // Populate subjects if empty
            if (subjectSelect.options.length <= 1) {
                settings.subjects.forEach(s => {
                    subjectSelect.innerHTML += `<option value="${s.id}">${s.icon} ${s.name}</option>`;
                });
            }

            // Also populate filter
            const filterSubject = document.getElementById('dashFilterSubject');
            if (filterSubject.options.length <= 1) {
                settings.subjects.forEach(s => {
                    filterSubject.innerHTML += `<option value="${s.id}">${s.icon} ${s.name}</option>`;
                });
            }

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('projectDeadline').min = today;

            updateMemberSelection();
        }

        // Update member selection based on team size and subject
        function updateMemberSelection() {
            const teamSize = parseInt(document.querySelector('input[name="teamSize"]:checked')?.value || 3);
            const subject = document.getElementById('projectSubject').value || 'programming';

            const suggestedMembers = Algorithm.getSuggestedTeam(subject, teamSize);
            const container = document.getElementById('memberSelection');

            container.innerHTML = suggestedMembers.map((member, index) => `
        <div class="member-select-item ${member.suggested ? 'selected suggested' : ''}" 
             data-id="${member.id}" onclick="toggleMember(this)">
          <div class="member-select-checkbox"></div>
          <div class="member-select-avatar">${member.avatar}</div>
          <div class="member-select-info">
            <div class="member-select-name">${member.name}</div>
            <div class="member-select-score">Ù†Ù‚Ø§Ø· Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${member.priorityScore}</div>
          </div>
        </div>
      `).join('');
        }

        // Toggle member selection
        function toggleMember(element) {
            element.classList.toggle('selected');
            Effects.playClick();
        }

        // Load members
        function loadMembers() {
            const container = document.getElementById('dashMembers');
            const members = Members.getAll();

            container.innerHTML = members.map(m => `
        <div class="card member-card card-3d" data-id="${m.id}">
          <div class="member-avatar">${m.avatar}</div>
          <h3 class="member-name">${m.name}</h3>
          <span class="member-role">${m.role}</span>
          <div class="member-stats">
            <div class="member-stat">
              <span class="member-stat-value">${m.stats.completedProjects}</span>
              <span class="member-stat-label">Ù…ÙƒØªÙ…Ù„</span>
            </div>
            <div class="member-stat">
              <span class="member-stat-value">${m.stats.activeProjects}</span>
              <span class="member-stat-label">Ø¬Ø§Ø±ÙŠ</span>
            </div>
            <div class="member-stat">
              <span class="member-stat-value">${m.stats.contributionScore}</span>
              <span class="member-stat-label">Ù†Ù‚Ø§Ø·</span>
            </div>
          </div>
          <div class="progress-bar" style="margin-top: 1rem;">
            <div class="progress-fill" style="width: ${Math.min(m.stats.contributionScore, 100)}%"></div>
          </div>
        </div>
      `).join('');
        }

        // Load achievements
        function loadAchievements() {
            Effects.renderLevelBadge(document.getElementById('achievementLevel'));
            Effects.renderAchievements(document.getElementById('achievementsBadges'));

            // Achievements list
            const achievements = Effects.getAchievements();
            const badgesList = [
                { id: 'firstProject', icon: 'ğŸ¯', name: 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', description: 'Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹' },
                { id: 'fiveProjects', icon: 'â­', name: 'Ù†Ø¬Ù… ØµØ§Ø¹Ø¯', description: 'Ø¥Ù†Ø´Ø§Ø¡ 5 Ù…Ø´Ø§Ø±ÙŠØ¹' },
                { id: 'tenProjects', icon: 'ğŸ†', name: 'Ù…ØªÙ…ÙŠØ²', description: 'Ø¥Ù†Ø´Ø§Ø¡ 10 Ù…Ø´Ø§Ø±ÙŠØ¹' },
                { id: 'firstComplete', icon: 'âœ…', name: 'Ù…Ù†Ø¬Ø²', description: 'Ø¥ÙƒÙ…Ø§Ù„ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹' },
                { id: 'fiveComplete', icon: 'ğŸ–ï¸', name: 'Ù…Ø­ØªØ±Ù', description: 'Ø¥ÙƒÙ…Ø§Ù„ 5 Ù…Ø´Ø§Ø±ÙŠØ¹' },
                { id: 'perfectTeam', icon: 'ğŸ‘¥', name: 'ÙØ±ÙŠÙ‚ ÙƒØ§Ù…Ù„', description: 'Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© ÙƒÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡' },
                { id: 'speedster', icon: 'âš¡', name: 'Ø³Ø±ÙŠØ¹ Ø§Ù„Ø¨Ø±Ù‚', description: 'Ø¥Ù†Ø¬Ø§Ø² Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† ÙŠÙˆÙ…' },
                { id: 'allSubjects', icon: 'ğŸ“š', name: 'Ø´Ø§Ù…Ù„', description: 'Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø«Ù…Ø§Ù†ÙŠØ©' }
            ];

            document.getElementById('achievementsList').innerHTML = badgesList.map(badge => `
        <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: ${achievements[badge.id] ? 'rgba(0, 255, 136, 0.1)' : 'var(--bg-secondary)'}; border-radius: var(--radius-md); margin-bottom: 0.5rem; opacity: ${achievements[badge.id] ? '1' : '0.5'};">
          <span style="font-size: 1.5rem;">${badge.icon}</span>
          <div>
            <div style="font-weight: 600;">${badge.name}</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">${badge.description}</div>
          </div>
          ${achievements[badge.id] ? '<span style="margin-right: auto; color: var(--success);">âœ“</span>' : '<span style="margin-right: auto; color: var(--text-muted);">ğŸ”’</span>'}
        </div>
      `).join('');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Lucide icons
            lucide.createIcons();

            // Get current user from session
            const session = Auth.getSession();
            if (!session) {
                window.location.href = 'login.html';
                return;
            }

            // Set greeting with actual user name
            document.getElementById('greetingText').textContent = `${App.getGreeting()}ØŒ ${session.name} ${session.avatar}`;

            // Set date
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('ar-IQ', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Render sidebar level
            Effects.renderLevelBadge(document.getElementById('sidebarLevel'));

            // Update sound toggle state
            document.getElementById('soundToggle').checked = Effects.soundEnabled;

            // Render user badge in settings
            document.getElementById('currentUserBadge').innerHTML = `
                <div class="user-avatar">${session.avatar}</div>
                <div class="user-info">
                    <div class="user-name">${session.name}</div>
                    <div class="user-role">${session.role}</div>
                </div>
            `;

            // New project form
            document.getElementById('newProjectForm').addEventListener('submit', (e) => {
                e.preventDefault();

                const selectedMembers = [];
                document.querySelectorAll('.member-select-item.selected').forEach(item => {
                    selectedMembers.push(item.dataset.id);
                });

                const teamSize = parseInt(document.querySelector('input[name="teamSize"]:checked').value);

                if (selectedMembers.length !== teamSize) {
                    App.showToast(`ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ${teamSize} Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø§Ù„Ø¶Ø¨Ø·`, 'warning');
                    return;
                }

                const project = {
                    title: document.getElementById('projectTitle').value,
                    description: document.getElementById('projectDescription').value,
                    subject: document.getElementById('projectSubject').value,
                    teamSize: teamSize,
                    deadline: document.getElementById('projectDeadline').value,
                    priority: document.querySelector('input[name="priority"]:checked').value,
                    assignedMembers: selectedMembers
                };

                Projects.create(project);

                // Log activity
                ActivityLog.log('project_create', session.memberId, {
                    message: `${session.name} Ø£Ù†Ø´Ø£ Ù…Ø´Ø±ÙˆØ¹: ${project.title}`
                });

                Effects.showConfetti();
                App.showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');

                // Update achievements
                Effects.initAchievements();

                // Reset form
                e.target.reset();
                document.getElementById('size3').checked = true;

                // Go to projects
                setTimeout(() => showSection('projects'), 1500);
            });

            // PIN change form
            document.getElementById('pinChangeForm').addEventListener('submit', (e) => {
                e.preventDefault();

                const oldPin = document.getElementById('oldPin').value;
                const newPin = document.getElementById('newPin').value;
                const confirmPin = document.getElementById('confirmPin').value;

                if (newPin !== confirmPin) {
                    App.showToast('Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚', 'error');
                    return;
                }

                const result = Auth.changePin(session.memberId, oldPin, newPin);

                if (result.success) {
                    App.showToast(result.message, 'success');
                    e.target.reset();
                } else {
                    App.showToast(result.message, 'error');
                }
            });

            // Load initial section
            loadOverview();
            loadAddProjectForm();

            // Re-render icons after content loads
            setTimeout(() => lucide.createIcons(), 100);
        });
    </script>

    <style>
        /* Sidebar toggle button for mobile */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 80px;
            right: 10px;
            width: 45px;
            height: 45px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1.5rem;
            z-index: 100;
            cursor: pointer;
        }

        @media (max-width: 991px) {
            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .sidebar {
                position: fixed;
                right: 0;
                top: 60px;
                height: calc(100vh - 60px);
                transform: translateX(100%);
                z-index: 200;
                box-shadow: -5px 0 20px rgba(0, 0, 0, 0.3);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .dashboard-main {
                margin-right: 0;
            }
        }
    </style>
</body>

</html>